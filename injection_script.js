
async () => {
    const settings = {"comfyUIUrl": "http://127.0.0.1:8188", "comfyUIClientId": "gemDirect", "imageWorkflowProfile": "flux-t2i", "videoWorkflowProfile": "wan-fun-inpaint", "sceneChainedWorkflowProfile": "wan-fun-inpaint", "sceneBookendWorkflowProfile": "wan-flf2v", "keyframeMode": "bookend", "bookendQAMode": {"enabled": true, "enforceKeyframePassthrough": true, "overrideAISuggestions": true, "notes": "Bookend QA mode: forces keyframe passthrough (skip AI overrides) and disables AI suggestions for consistency testing"}, "workflowProfiles": {"flux-t2i": {"id": "flux-t2i", "label": "FLUX Text\u2192Image (Keyframe)", "workflowJson": "{\"3\":{\"inputs\":{\"seed\":123456789,\"steps\":20,\"cfg\":1.0,\"sampler_name\":\"euler\",\"scheduler\":\"simple\",\"denoise\":1.0,\"model\":[\"12\",0],\"positive\":[\"6\",0],\"negative\":[\"7\",0],\"latent_image\":[\"5\",0]},\"class_type\":\"KSampler\",\"_meta\":{\"title\":\"KSampler\"}},\"5\":{\"inputs\":{\"width\":1280,\"height\":720,\"batch_size\":1},\"class_type\":\"EmptySD3LatentImage\",\"_meta\":{\"title\":\"Empty SD3 Latent Image\"}},\"6\":{\"inputs\":{\"text\":\"A cinematic scene placeholder\",\"clip\":[\"11\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Positive Prompt)\"}},\"7\":{\"inputs\":{\"text\":\"\",\"clip\":[\"11\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Negative Prompt)\"}},\"8\":{\"inputs\":{\"samples\":[\"3\",0],\"vae\":[\"10\",0]},\"class_type\":\"VAEDecode\",\"_meta\":{\"title\":\"VAE Decode\"}},\"9\":{\"inputs\":{\"filename_prefix\":\"FLUX_keyframe\",\"images\":[\"8\",0]},\"class_type\":\"SaveImage\",\"_meta\":{\"title\":\"Save Image\"}},\"10\":{\"inputs\":{\"vae_name\":\"ae.safetensors\"},\"class_type\":\"VAELoader\",\"_meta\":{\"title\":\"Load VAE\"}},\"11\":{\"inputs\":{\"clip_name1\":\"t5\\\\t5xxl_fp8_e4m3fn_scaled.safetensors\",\"clip_name2\":\"clip_l.safetensors\",\"type\":\"flux\"},\"class_type\":\"DualCLIPLoader\",\"_meta\":{\"title\":\"DualCLIPLoader\"}},\"12\":{\"inputs\":{\"unet_name\":\"flux1-krea-dev_fp8_scaled.safetensors\",\"weight_dtype\":\"fp8_e4m3fn\"},\"class_type\":\"UNETLoader\",\"_meta\":{\"title\":\"Load Diffusion Model\"}}}", "mapping": {"6:text": "human_readable_prompt", "7:text": "negative_prompt"}, "metadata": {"lastSyncedAt": 1732489200000, "highlightMappings": [{"type": "human_readable_prompt", "nodeId": "6", "inputName": "text", "nodeTitle": "CLIP Text Encode (Positive Prompt)"}], "missingMappings": [], "warnings": []}}, "wan-t2i": {"id": "wan-t2i", "label": "WAN Text\u2192Image (Keyframe)", "workflowJson": "{\"3\":{\"inputs\":{\"seed\":942500763821827,\"steps\":30,\"cfg\":5.5,\"sampler_name\":\"res_multistep\",\"scheduler\":\"simple\",\"denoise\":1,\"model\":[\"11\",0],\"positive\":[\"6\",0],\"negative\":[\"7\",0],\"latent_image\":[\"13\",0]},\"class_type\":\"KSampler\",\"_meta\":{\"title\":\"KSampler\"}},\"4\":{\"inputs\":{\"ckpt_name\":\"NetaYumev35_pretrained_all_in_one.safetensors\"},\"class_type\":\"CheckpointLoaderSimple\",\"_meta\":{\"title\":\"Load Checkpoint\"}},\"6\":{\"inputs\":{\"text\":\"You are an assistant designed to generate high quality anime images based on textual prompts. <Prompt Start> @comfyanonymous, \\\"Warm and cheerful digital illustration of a girl standing in the middle of an orange grove, surrounded by lush green leaves and ripe, vibrant oranges hanging from the trees. She has chestnut-brown hair tied in a single loose braid draped over her shoulder, with soft bangs framing her bright, smiling face.\\n Her expression is full of joy and sunshine\u2014eyes squinting slightly, mouth open in a wide, carefree smile, radiating pure happiness. She wears a crisp white blouse underneath a black jacket, slightly unbuttoned for a relaxed look. The sunlight filters through the leaves above, casting dappled golden light on her hair and shoulders, creating a warm, inviting atmosphere.\\n  A few oranges hang close to her head, and one or two lie on the ground around her feet. The background features soft-focus trees stretching into the distance, with sunlight breaking through the foliage. The art style is painterly and soft, emphasizing the natural setting and the girl's radiant, wholesome charm.\\\"\",\"clip\":[\"4\",1]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Positive Prompt)\"}},\"7\":{\"inputs\":{\"text\":\"You are an assistant designed to generate low-quality images based on textual prompts <Prompt Start> blurry, worst quality, low quality, jpeg artifacts, signature, watermark, username, error, deformed hands, bad anatomy, extra limbs, poorly drawn hands, poorly drawn face, mutation, deformed, extra eyes, extra arms, extra legs, malformed limbs, fused fingers, too many fingers, long neck, cross-eyed, bad proportions, missing arms, missing legs, extra digit, fewer digits, cropped\",\"clip\":[\"4\",1]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Negative Prompt)\"}},\"8\":{\"inputs\":{\"samples\":[\"3\",0],\"vae\":[\"4\",2]},\"class_type\":\"VAEDecode\",\"_meta\":{\"title\":\"VAE Decode\"}},\"9\":{\"inputs\":{\"filename_prefix\":\"NetaYume_Lumina_3.5\",\"images\":[\"8\",0]},\"class_type\":\"SaveImage\",\"_meta\":{\"title\":\"Save Image\"}},\"11\":{\"inputs\":{\"shift\":4,\"model\":[\"4\",0]},\"class_type\":\"ModelSamplingAuraFlow\",\"_meta\":{\"title\":\"ModelSamplingAuraFlow\"}},\"13\":{\"inputs\":{\"width\":1920,\"height\":1080,\"batch_size\":1},\"class_type\":\"EmptySD3LatentImage\",\"_meta\":{\"title\":\"EmptySD3LatentImage\"}}}", "mapping": {"6:text": "human_readable_prompt", "7:text": "negative_prompt"}, "metadata": {"lastSyncedAt": 1763404059418, "highlightMappings": [{"type": "human_readable_prompt", "nodeId": "6", "inputName": "text", "nodeTitle": "CLIP Text Encode (Positive Prompt)"}], "missingMappings": [], "warnings": []}}, "wan-i2v": {"id": "wan-i2v", "label": "WAN Text+Image\u2192Video", "workflowJson": "{\n  \"3\": {\n    \"inputs\": {\n      \"seed\": 878722216565963,\n      \"steps\": 12,\n      \"cfg\": 5,\n      \"sampler_name\": \"uni_pc\",\n      \"scheduler\": \"simple\",\n      \"denoise\": 1,\n      \"model\": [\n        \"48\",\n        0\n      ],\n      \"positive\": [\n        \"6\",\n        0\n      ],\n      \"negative\": [\n        \"7\",\n        0\n      ],\n      \"latent_image\": [\n        \"55\",\n        0\n      ]\n    },\n    \"class_type\": \"KSampler\",\n    \"_meta\": {\n      \"title\": \"KSampler\"\n    }\n  },\n  \"6\": {\n    \"inputs\": {\n      \"text\": \"Low contrast. In a retro 1970s-style subway station, a street musician plays in dim colors and rough textures. He wears an old jacket, playing guitar with focus. Commuters hurry by, and a small crowd gathers to listen. The camera slowly moves right, capturing the blend of music and city noise, with old subway signs and mottled walls in the background.\",\n      \"clip\": [\n        \"38\",\n        0\n      ]\n    },\n    \"class_type\": \"CLIPTextEncode\",\n    \"_meta\": {\n      \"title\": \"CLIP Text Encode (Positive Prompt)\"\n    }\n  },\n  \"7\": {\n    \"inputs\": {\n      \"text\": \"\u8272\u8c03\u8273\u4e3d\uff0c\u8fc7\u66dd\uff0c\u9759\u6001\uff0c\u7ec6\u8282\u6a21\u7cca\u4e0d\u6e05\uff0c\u5b57\u5e55\uff0c\u98ce\u683c\uff0c\u4f5c\u54c1\uff0c\u753b\u4f5c\uff0c\u753b\u9762\uff0c\u9759\u6b62\uff0c\u6574\u4f53\u53d1\u7070\uff0c\u6700\u5dee\u8d28\u91cf\uff0c\u4f4e\u8d28\u91cf\uff0cJPEG\u538b\u7f29\u6b8b\u7559\uff0c\u4e11\u964b\u7684\uff0c\u6b8b\u7f3a\u7684\uff0c\u591a\u4f59\u7684\u624b\u6307\uff0c\u753b\u5f97\u4e0d\u597d\u7684\u624b\u90e8\uff0c\u753b\u5f97\u4e0d\u597d\u7684\u8138\u90e8\uff0c\u7578\u5f62\u7684\uff0c\u6bc1\u5bb9\u7684\uff0c\u5f62\u6001\u7578\u5f62\u7684\u80a2\u4f53\uff0c\u624b\u6307\u878d\u5408\uff0c\u9759\u6b62\u4e0d\u52a8\u7684\u753b\u9762\uff0c\u6742\u4e71\u7684\u80cc\u666f\uff0c\u4e09\u6761\u817f\uff0c\u80cc\u666f\u4eba\u5f88\u591a\uff0c\u5012\u7740\u8d70\",\n      \"clip\": [\n        \"38\",\n        0\n      ]\n    },\n    \"class_type\": \"CLIPTextEncode\",\n    \"_meta\": {\n      \"title\": \"CLIP Text Encode (Negative Prompt)\"\n    }\n  },\n  \"8\": {\n    \"inputs\": {\n      \"samples\": [\n        \"3\",\n        0\n      ],\n      \"vae\": [\n        \"39\",\n        0\n      ]\n    },\n    \"class_type\": \"VAEDecode\",\n    \"_meta\": {\n      \"title\": \"VAE Decode\"\n    }\n  },\n  \"37\": {\n    \"inputs\": {\n      \"unet_name\": \"wan2.2_ti2v_5B_fp16.safetensors\",\n      \"weight_dtype\": \"default\"\n    },\n    \"class_type\": \"UNETLoader\",\n    \"_meta\": {\n      \"title\": \"Load Diffusion Model\"\n    }\n  },\n  \"38\": {\n    \"inputs\": {\n      \"clip_name\": \"umt5_xxl_fp8_e4m3fn_scaled.safetensors\",\n      \"type\": \"wan\",\n      \"device\": \"default\"\n    },\n    \"class_type\": \"CLIPLoader\",\n    \"_meta\": {\n      \"title\": \"Load CLIP\"\n    }\n  },\n  \"39\": {\n    \"inputs\": {\n      \"vae_name\": \"wan2.2_vae.safetensors\"\n    },\n    \"class_type\": \"VAELoader\",\n    \"_meta\": {\n      \"title\": \"Load VAE\"\n    }\n  },\n  \"48\": {\n    \"inputs\": {\n      \"shift\": 8,\n      \"model\": [\n        \"37\",\n        0\n      ]\n    },\n    \"class_type\": \"ModelSamplingSD3\",\n    \"_meta\": {\n      \"title\": \"ModelSamplingSD3\"\n    }\n  },\n  \"55\": {\n    \"inputs\": {\n      \"width\": 1280,\n      \"height\": 544,\n      \"length\": 49,\n      \"batch_size\": 1,\n      \"vae\": [\n        \"39\",\n        0\n      ],\n      \"start_image\": [\n        \"56\",\n        0\n      ]\n    },\n    \"class_type\": \"Wan22ImageToVideoLatent\",\n    \"_meta\": {\n      \"title\": \"Wan22ImageToVideoLatent\"\n    }\n  },\n  \"56\": {\n    \"inputs\": {\n      \"image\": \"example.png\"\n    },\n    \"class_type\": \"LoadImage\",\n    \"_meta\": {\n      \"title\": \"Load Image\"\n    }\n  },\n  \"57\": {\n    \"inputs\": {\n      \"fps\": 24,\n      \"images\": [\n        \"8\",\n        0\n      ]\n    },\n    \"class_type\": \"CreateVideo\",\n    \"_meta\": {\n      \"title\": \"Create Video\"\n    }\n  },\n  \"58\": {\n    \"inputs\": {\n      \"filename_prefix\": \"video/ComfyUI\",\n      \"format\": \"auto\",\n      \"codec\": \"auto\",\n      \"video\": [\n        \"57\",\n        0\n      ]\n    },\n    \"class_type\": \"SaveVideo\",\n    \"_meta\": {\n      \"title\": \"Save Video\"\n    }\n  }\n}", "mapping": {"6:text": "human_readable_prompt", "56:image": "keyframe_image", "7:text": "negative_prompt"}, "metadata": {"lastSyncedAt": 1763568701443, "highlightMappings": [{"type": "human_readable_prompt", "nodeTitle": "CLIP Text Encode (Positive Prompt)", "nodeId": "6", "inputName": "text"}, {"type": "keyframe_image", "nodeTitle": "Load Image", "nodeId": "56", "inputName": "image"}], "missingMappings": [], "warnings": []}}, "wan-flf2v": {"id": "wan-flf2v", "label": "WAN First-Last-Frame\u2192Video (Bookends)", "workflowJson": "{\"1\":{\"inputs\":{\"clip_name\":\"umt5_xxl_fp8_e4m3fn_scaled.safetensors\",\"type\":\"wan\",\"device\":\"default\"},\"class_type\":\"CLIPLoader\",\"_meta\":{\"title\":\"Load CLIP\"}},\"2\":{\"inputs\":{\"vae_name\":\"wan2.2_vae.safetensors\"},\"class_type\":\"VAELoader\",\"_meta\":{\"title\":\"Load VAE\"}},\"3\":{\"inputs\":{\"unet_name\":\"wan2.2_ti2v_5B_fp16.safetensors\",\"weight_dtype\":\"default\"},\"class_type\":\"UNETLoader\",\"_meta\":{\"title\":\"Load Diffusion Model (5B)\"}},\"4\":{\"inputs\":{\"shift\":5,\"model\":[\"3\",0]},\"class_type\":\"ModelSamplingSD3\",\"_meta\":{\"title\":\"ModelSamplingSD3\"}},\"5\":{\"inputs\":{\"text\":\"A cinematic video scene with smooth motion and natural transitions between the start and end frames. Fluid camera movement, stable footage, no jitter.\",\"clip\":[\"1\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Positive Prompt)\"}},\"6\":{\"inputs\":{\"text\":\"flickering, shaking, jittering, unstable, vibrating, strobing, pulsating, frame jumping, temporal noise, color banding, aliasing, \u8272\u8c03\u8273\u4e3d\uff0c\u8fc7\u66dd\uff0c\u9759\u6001\uff0c\u7ec6\u8282\u6a21\u7cca\u4e0d\u6e05\uff0c\u5b57\u5e55\uff0c\u98ce\u683c\uff0c\u4f5c\u54c1\uff0c\u753b\u4f5c\uff0c\u753b\u9762\uff0c\u9759\u6b62\uff0c\u6574\u4f53\u53d1\u7070\uff0c\u6700\u5dee\u8d28\u91cf\uff0c\u4f4e\u8d28\u91cf\uff0cJPEG\u538b\u7f29\u6b8b\u7559\uff0c\u4e11\u964b\u7684\uff0c\u6b8b\u7f3a\u7684\uff0c\u591a\u4f59\u7684\u624b\u6307\uff0c\u7578\u5f62\u7684\uff0c\u6bc1\u5bb9\u7684\uff0c\u5f62\u6001\u7578\u5f62\u7684\u80a2\u4f53\uff0c\u624b\u6307\u878d\u5408\uff0c\u9759\u6b62\u4e0d\u52a8\u7684\u753b\u9762\uff0c\u6742\u4e71\u7684\u80cc\u666f\uff0c\u5012\u7740\u8d70, static, no motion, frozen, split screen, multiple panels, comic panels, manga style, grid layout, wobbly camera, unstable shot\",\"clip\":[\"1\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Negative Prompt)\"}},\"10\":{\"inputs\":{\"image\":\"start_keyframe.png\"},\"class_type\":\"LoadImage\",\"_meta\":{\"title\":\"Load Start Image\"}},\"11\":{\"inputs\":{\"image\":\"end_keyframe.png\"},\"class_type\":\"LoadImage\",\"_meta\":{\"title\":\"Load End Image\"}},\"12\":{\"inputs\":{\"width\":960,\"height\":540,\"length\":49,\"batch_size\":1,\"tile_size\":512,\"overlap\":64,\"temporal_size\":64,\"temporal_overlap\":8,\"vae\":[\"2\",0],\"start_image\":[\"10\",0],\"end_image\":[\"11\",0]},\"class_type\":\"Wan22FirstLastFrameToVideoLatentTiledVAE\",\"_meta\":{\"title\":\"WAN 2.2 First-Last Frame to Video Latent (Tiled VAE)\"}},\"13\":{\"inputs\":{\"seed\":123456789,\"steps\":30,\"cfg\":4.5,\"sampler_name\":\"uni_pc\",\"scheduler\":\"simple\",\"denoise\":1,\"model\":[\"4\",0],\"positive\":[\"5\",0],\"negative\":[\"6\",0],\"latent_image\":[\"12\",0]},\"class_type\":\"KSampler\",\"_meta\":{\"title\":\"KSampler\"}},\"14\":{\"inputs\":{\"samples\":[\"13\",0],\"vae\":[\"2\",0]},\"class_type\":\"VAEDecode\",\"_meta\":{\"title\":\"VAE Decode\"}},\"15\":{\"inputs\":{\"fps\":16,\"images\":[\"14\",0]},\"class_type\":\"CreateVideo\",\"_meta\":{\"title\":\"Create Video\"}},\"16\":{\"inputs\":{\"filename_prefix\":\"video/wan2_flf2v\",\"format\":\"auto\",\"codec\":\"auto\",\"video\":[\"15\",0]},\"class_type\":\"SaveVideo\",\"_meta\":{\"title\":\"Save Video\"}}}", "mapping": {"5:text": "human_readable_prompt", "6:text": "negative_prompt", "10:image": "start_image", "11:image": "end_image"}, "metadata": {"lastSyncedAt": 1733357000000, "highlightMappings": [{"type": "human_readable_prompt", "nodeTitle": "CLIP Text Encode (Positive Prompt)", "nodeId": "5", "inputName": "text"}, {"type": "start_image", "nodeTitle": "Load Start Image", "nodeId": "10", "inputName": "image"}, {"type": "end_image", "nodeTitle": "Load End Image", "nodeId": "11", "inputName": "image"}], "missingMappings": [], "warnings": [], "notes": "Anti-flicker tuned: shift 5 (was 8), CFG 4.5 (was 5.5), 30 steps (was 24). Negative prompt includes flickering/shaking/jittering terms. Custom node: https://github.com/stduhpf/ComfyUI--Wan22FirstLastFrameToVideoLatent"}}, "wan-fun-inpaint": {"id": "wan-fun-inpaint", "label": "WAN Fun Inpaint\u2192Video (Smooth Motion)", "workflowJson": "{\"1\":{\"inputs\":{\"clip_name\":\"umt5_xxl_fp8_e4m3fn_scaled.safetensors\",\"type\":\"wan\",\"device\":\"default\"},\"class_type\":\"CLIPLoader\",\"_meta\":{\"title\":\"Load CLIP\"}},\"2\":{\"inputs\":{\"vae_name\":\"wan2.2_vae.safetensors\"},\"class_type\":\"VAELoader\",\"_meta\":{\"title\":\"Load VAE\"}},\"3\":{\"inputs\":{\"unet_name\":\"wan2.2_fun_inpaint_5B_bf16.safetensors\",\"weight_dtype\":\"default\"},\"class_type\":\"UNETLoader\",\"_meta\":{\"title\":\"Load Diffusion Model (5B Fun Inpaint)\"}},\"4\":{\"inputs\":{\"shift\":5,\"model\":[\"3\",0]},\"class_type\":\"ModelSamplingSD3\",\"_meta\":{\"title\":\"ModelSamplingSD3\"}},\"5\":{\"inputs\":{\"text\":\"A cinematic video scene with smooth motion and natural transitions. High quality, detailed, professional cinematography. Fluid movement, stable footage.\",\"clip\":[\"1\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Positive Prompt)\"}},\"6\":{\"inputs\":{\"text\":\"flickering, shaking, jittering, unstable, vibrating, strobing, pulsating, frame jumping, temporal noise, color banding, aliasing, blurry, worst quality, low quality, jpeg artifacts, static, no motion, frozen, split screen, multiple panels, morphing face, identity shift, changing features, inconsistent appearance, deformed, distorted, glitch, noise, grainy, wobbly camera\",\"clip\":[\"1\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Negative Prompt)\"}},\"10\":{\"inputs\":{\"image\":\"start_keyframe.png\"},\"class_type\":\"LoadImage\",\"_meta\":{\"title\":\"Load Start Image\"}},\"11\":{\"inputs\":{\"image\":\"end_keyframe.png\"},\"class_type\":\"LoadImage\",\"_meta\":{\"title\":\"Load End Image\"}},\"12\":{\"inputs\":{\"width\":1280,\"height\":544,\"length\":49,\"batch_size\":1,\"positive\":[\"5\",0],\"negative\":[\"6\",0],\"vae\":[\"2\",0],\"clip_vision_output\":null,\"start_image\":[\"10\",0],\"end_image\":[\"11\",0]},\"class_type\":\"WanFunInpaintToVideo\",\"_meta\":{\"title\":\"WAN Fun Inpaint to Video\"}},\"13\":{\"inputs\":{\"seed\":123456789,\"steps\":20,\"cfg\":4.5,\"sampler_name\":\"uni_pc\",\"scheduler\":\"simple\",\"denoise\":1,\"model\":[\"4\",0],\"positive\":[\"12\",0],\"negative\":[\"12\",1],\"latent_image\":[\"12\",2]},\"class_type\":\"KSampler\",\"_meta\":{\"title\":\"KSampler\"}},\"14\":{\"inputs\":{\"samples\":[\"13\",0],\"vae\":[\"2\",0]},\"class_type\":\"VAEDecode\",\"_meta\":{\"title\":\"VAE Decode\"}},\"15\":{\"inputs\":{\"fps\":24,\"images\":[\"14\",0]},\"class_type\":\"CreateVideo\",\"_meta\":{\"title\":\"Create Video\"}},\"16\":{\"inputs\":{\"filename_prefix\":\"video/wan2_fun_inpaint\",\"format\":\"auto\",\"codec\":\"auto\",\"video\":[\"15\",0]},\"class_type\":\"SaveVideo\",\"_meta\":{\"title\":\"Save Video\"}}}", "mapping": {"5:text": "human_readable_prompt", "6:text": "negative_prompt", "10:image": "start_image", "11:image": "end_image"}, "metadata": {"lastSyncedAt": 1733357000000, "highlightMappings": [{"type": "human_readable_prompt", "nodeTitle": "CLIP Text Encode (Positive Prompt)", "nodeId": "5", "inputName": "text"}, {"type": "start_image", "nodeTitle": "Load Start Image", "nodeId": "10", "inputName": "image"}, {"type": "end_image", "nodeTitle": "Load End Image", "nodeId": "11", "inputName": "image"}], "missingMappings": [], "warnings": [], "notes": "Anti-flicker tuned: shift 5 (was 8), CFG 4.5 (was 5), 20 steps (was 12). Enhanced negative prompt includes flickering/shaking/jittering/wobbly terms for temporal stability."}}, "wan-fun-control": {"id": "wan-fun-control", "label": "WAN Fun Control\u2192Video (Control-based)", "workflowJson": "{\"1\":{\"inputs\":{\"clip_name\":\"umt5_xxl_fp8_e4m3fn_scaled.safetensors\",\"type\":\"wan\",\"device\":\"default\"},\"class_type\":\"CLIPLoader\",\"_meta\":{\"title\":\"Load CLIP\"}},\"2\":{\"inputs\":{\"vae_name\":\"wan2.2_vae.safetensors\"},\"class_type\":\"VAELoader\",\"_meta\":{\"title\":\"Load VAE\"}},\"3\":{\"inputs\":{\"unet_name\":\"wan2.2_fun_control_5B_bf16.safetensors\",\"weight_dtype\":\"default\"},\"class_type\":\"UNETLoader\",\"_meta\":{\"title\":\"Load Diffusion Model (5B Fun Control)\"}},\"4\":{\"inputs\":{\"shift\":8,\"model\":[\"3\",0]},\"class_type\":\"ModelSamplingSD3\",\"_meta\":{\"title\":\"ModelSamplingSD3\"}},\"5\":{\"inputs\":{\"text\":\"A cinematic video scene with smooth motion and natural transitions. High quality, detailed, professional cinematography.\",\"clip\":[\"1\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Positive Prompt)\"}},\"6\":{\"inputs\":{\"text\":\"static, no motion, frozen, split screen, multiple panels, low quality\",\"clip\":[\"1\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Negative Prompt)\"}},\"10\":{\"inputs\":{\"image\":\"ref_keyframe.png\"},\"class_type\":\"LoadImage\",\"_meta\":{\"title\":\"Load Reference Image\"}},\"11\":{\"inputs\":{\"file\":\"control_video.mp4\"},\"class_type\":\"LoadVideo\",\"_meta\":{\"title\":\"Load Control Video\"}},\"12\":{\"inputs\":{\"images\":[\"11\",0]},\"class_type\":\"GetVideoComponents\",\"_meta\":{\"title\":\"Get Video Components\"}},\"13\":{\"inputs\":{\"low_threshold\":0.1,\"high_threshold\":0.6,\"image\":[\"12\",0]},\"class_type\":\"Canny\",\"_meta\":{\"title\":\"Canny Edge Detection\"}},\"14\":{\"inputs\":{\"width\":1280,\"height\":720,\"length\":81,\"batch_size\":1,\"positive\":[\"5\",0],\"negative\":[\"6\",0],\"vae\":[\"2\",0],\"ref_image\":[\"10\",0],\"control_video\":[\"13\",0]},\"class_type\":\"Wan22FunControlToVideo\",\"_meta\":{\"title\":\"WAN Fun Control to Video\"}},\"15\":{\"inputs\":{\"seed\":123456789,\"steps\":20,\"cfg\":3.5,\"sampler_name\":\"euler\",\"scheduler\":\"simple\",\"denoise\":1,\"model\":[\"4\",0],\"positive\":[\"14\",0],\"negative\":[\"14\",1],\"latent_image\":[\"14\",2]},\"class_type\":\"KSampler\",\"_meta\":{\"title\":\"KSampler\"}},\"16\":{\"inputs\":{\"samples\":[\"15\",0],\"vae\":[\"2\",0]},\"class_type\":\"VAEDecode\",\"_meta\":{\"title\":\"VAE Decode\"}},\"17\":{\"inputs\":{\"fps\":16,\"images\":[\"16\",0]},\"class_type\":\"CreateVideo\",\"_meta\":{\"title\":\"Create Video\"}},\"18\":{\"inputs\":{\"filename_prefix\":\"video/wan2_fun_control\",\"format\":\"auto\",\"codec\":\"auto\",\"video\":[\"17\",0]},\"class_type\":\"SaveVideo\",\"_meta\":{\"title\":\"Save Video\"}}}", "mapping": {"5:text": "human_readable_prompt", "6:text": "negative_prompt", "10:image": "ref_image", "11:file": "control_video"}, "metadata": {"lastSyncedAt": 1732700000000, "highlightMappings": [{"type": "human_readable_prompt", "nodeTitle": "CLIP Text Encode (Positive Prompt)", "nodeId": "5", "inputName": "text"}, {"type": "ref_image", "nodeTitle": "Load Reference Image", "nodeId": "10", "inputName": "image"}, {"type": "control_video", "nodeTitle": "Load Control Video", "nodeId": "11", "inputName": "file"}], "missingMappings": [], "warnings": [], "notes": "Uses Wan22FunControlToVideo with reference image and control video (Canny/Depth/Pose)."}}, "wan-flf2v-feta": {"id": "wan-flf2v-feta", "label": "WAN FLF2V + FETA Enhancement (Temporal Coherence)", "workflowJson": "{\"1\":{\"inputs\":{\"model\":\"wan2.2_ti2v_5B_fp16.safetensors\",\"base_precision\":\"bf16\",\"quantization\":\"disabled\",\"load_device\":\"offload_device\"},\"class_type\":\"WanVideoModelLoader\",\"_meta\":{\"title\":\"WanVideo Model Loader (5B FLF2V)\"}},\"2\":{\"inputs\":{\"model_name\":\"t5\\\\t5xxl_fp8_e4m3fn_scaled.safetensors\",\"precision\":\"bf16\"},\"class_type\":\"LoadWanVideoT5TextEncoder\",\"_meta\":{\"title\":\"WanVideo T5 Text Encoder Loader\"}},\"3\":{\"inputs\":{\"model_name\":\"wan2.2_vae.safetensors\",\"precision\":\"bf16\"},\"class_type\":\"WanVideoVAELoader\",\"_meta\":{\"title\":\"WanVideo VAE Loader\"}},\"4\":{\"inputs\":{\"clip_name\":\"clip_vision_h.safetensors\"},\"class_type\":\"CLIPVisionLoader\",\"_meta\":{\"title\":\"Load CLIP Vision\"}},\"5\":{\"inputs\":{\"image\":\"start_keyframe.png\"},\"class_type\":\"LoadImage\",\"_meta\":{\"title\":\"Load Start Image\"}},\"6\":{\"inputs\":{\"image\":\"end_keyframe.png\"},\"class_type\":\"LoadImage\",\"_meta\":{\"title\":\"Load End Image\"}},\"7\":{\"inputs\":{\"clip_vision\":[\"4\",0],\"image_1\":[\"5\",0],\"strength_1\":1.0,\"strength_2\":1.0,\"crop\":\"center\",\"combine_embeds\":\"average\",\"force_offload\":true,\"image_2\":[\"6\",0]},\"class_type\":\"WanVideoClipVisionEncode\",\"_meta\":{\"title\":\"WanVideo ClipVision Encode (Start+End)\"}},\"8\":{\"inputs\":{\"width\":832,\"height\":480,\"num_frames\":81,\"noise_aug_strength\":0.0,\"start_latent_strength\":1.0,\"end_latent_strength\":1.0,\"force_offload\":true,\"vae\":[\"3\",0],\"clip_embeds\":[\"7\",0],\"start_image\":[\"5\",0],\"end_image\":[\"6\",0],\"fun_or_fl2v_model\":true},\"class_type\":\"WanVideoImageToVideoEncode\",\"_meta\":{\"title\":\"WanVideo ImageToVideo Encode (FLF2V)\"}},\"9\":{\"inputs\":{\"positive_prompt\":\"A cinematic video scene with smooth motion and natural transitions between the start and end frames. Fluid camera movement, stable footage, no jitter.\",\"negative_prompt\":\"flickering, shaking, jittering, unstable, vibrating, strobing, pulsating, frame jumping, temporal noise, color banding, aliasing, static, no motion, frozen, split screen, multiple panels, wobbly camera, unstable shot\",\"t5\":[\"2\",0],\"force_offload\":true},\"class_type\":\"WanVideoTextEncode\",\"_meta\":{\"title\":\"WanVideo TextEncode\"}},\"10\":{\"inputs\":{\"weight\":2.0,\"start_percent\":0.0,\"end_percent\":1.0},\"class_type\":\"WanVideoEnhanceAVideo\",\"_meta\":{\"title\":\"WanVideo Enhance-A-Video (FETA)\"}},\"11\":{\"inputs\":{\"model\":[\"1\",0],\"image_embeds\":[\"8\",0],\"steps\":30,\"cfg\":4.5,\"shift\":5.0,\"seed\":123456789,\"force_offload\":true,\"scheduler\":\"unipc\",\"riflex_freq_index\":0,\"text_embeds\":[\"9\",0],\"feta_args\":[\"10\",0]},\"class_type\":\"WanVideoSampler\",\"_meta\":{\"title\":\"WanVideo Sampler (with FETA)\"}},\"12\":{\"inputs\":{\"vae\":[\"3\",0],\"samples\":[\"11\",0],\"enable_vae_tiling\":false,\"tile_x\":272,\"tile_y\":272,\"tile_stride_x\":144,\"tile_stride_y\":128},\"class_type\":\"WanVideoDecode\",\"_meta\":{\"title\":\"WanVideo Decode\"}},\"13\":{\"inputs\":{\"frame_rate\":16,\"loop_count\":0,\"filename_prefix\":\"video/wan2_flf2v_feta\",\"format\":\"video/h264-mp4\",\"pix_fmt\":\"yuv420p\",\"crf\":19,\"save_metadata\":true,\"pingpong\":false,\"save_output\":true,\"images\":[\"12\",0]},\"class_type\":\"VHS_VideoCombine\",\"_meta\":{\"title\":\"Video Combine (VHS)\"}}}", "mapping": {"9:positive_prompt": "human_readable_prompt", "9:negative_prompt": "negative_prompt", "5:image": "start_image", "6:image": "end_image", "10:weight": "feta_weight"}, "metadata": {"lastSyncedAt": 1733357000000, "highlightMappings": [{"type": "human_readable_prompt", "nodeTitle": "WanVideo TextEncode", "nodeId": "9", "inputName": "positive_prompt"}, {"type": "start_image", "nodeTitle": "Load Start Image", "nodeId": "5", "inputName": "image"}, {"type": "end_image", "nodeTitle": "Load End Image", "nodeId": "6", "inputName": "image"}], "missingMappings": [], "warnings": [], "notes": "WanVideoSampler-based workflow with FETA (Enhance-A-Video) for improved temporal coherence. Uses native WanVideoWrapper nodes instead of KSampler. FETA weight default 2.0, adjustable via feta_weight mapping. Anti-flicker params: shift=5, CFG=4.5, 30 steps."}}, "wan-ipadapter": {"id": "wan-ipadapter", "label": "WAN IP-Adapter + Video (Character Consistency)", "workflowJson": "{\"3\":{\"inputs\":{\"seed\":878722216565963,\"steps\":20,\"cfg\":4.5,\"sampler_name\":\"uni_pc\",\"scheduler\":\"simple\",\"denoise\":1,\"model\":[\"1010\",0],\"positive\":[\"6\",0],\"negative\":[\"7\",0],\"latent_image\":[\"55\",0]},\"class_type\":\"KSampler\",\"_meta\":{\"title\":\"KSampler\"}},\"6\":{\"inputs\":{\"text\":\"A cinematic shot of the character in the scene with smooth motion.\",\"clip\":[\"38\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Positive Prompt)\"}},\"7\":{\"inputs\":{\"text\":\"flickering, shaking, jittering, unstable, vibrating, strobing, blurry, low quality, watermark, text, bad anatomy, distorted, morphing face, identity shift, changing features, inconsistent appearance\",\"clip\":[\"38\",0]},\"class_type\":\"CLIPTextEncode\",\"_meta\":{\"title\":\"CLIP Text Encode (Negative Prompt)\"}},\"8\":{\"inputs\":{\"samples\":[\"3\",0],\"vae\":[\"39\",0]},\"class_type\":\"VAEDecode\",\"_meta\":{\"title\":\"VAE Decode\"}},\"37\":{\"inputs\":{\"unet_name\":\"wan2.2_ti2v_5B_fp16.safetensors\",\"weight_dtype\":\"default\"},\"class_type\":\"UNETLoader\",\"_meta\":{\"title\":\"Load Diffusion Model\"}},\"38\":{\"inputs\":{\"clip_name\":\"umt5_xxl_fp8_e4m3fn_scaled.safetensors\",\"type\":\"wan\",\"device\":\"default\"},\"class_type\":\"CLIPLoader\",\"_meta\":{\"title\":\"Load CLIP\"}},\"39\":{\"inputs\":{\"vae_name\":\"wan2.2_vae.safetensors\"},\"class_type\":\"VAELoader\",\"_meta\":{\"title\":\"Load VAE\"}},\"48\":{\"inputs\":{\"shift\":5,\"model\":[\"37\",0]},\"class_type\":\"ModelSamplingSD3\",\"_meta\":{\"title\":\"ModelSamplingSD3\"}},\"55\":{\"inputs\":{\"width\":1280,\"height\":544,\"length\":49,\"batch_size\":1,\"vae\":[\"39\",0],\"start_image\":[\"56\",0]},\"class_type\":\"Wan22ImageToVideoLatent\",\"_meta\":{\"title\":\"Wan22ImageToVideoLatent\"}},\"56\":{\"inputs\":{\"image\":\"keyframe.png\"},\"class_type\":\"LoadImage\",\"_meta\":{\"title\":\"Load Keyframe Image\"}},\"57\":{\"inputs\":{\"fps\":24,\"images\":[\"8\",0]},\"class_type\":\"CreateVideo\",\"_meta\":{\"title\":\"Create Video\"}},\"58\":{\"inputs\":{\"filename_prefix\":\"video/wan2_ipadapter\",\"format\":\"auto\",\"codec\":\"auto\",\"video\":[\"57\",0]},\"class_type\":\"SaveVideo\",\"_meta\":{\"title\":\"Save Video\"}},\"1000\":{\"inputs\":{\"clip_name\":\"CLIP-ViT-H-14-laion2B-s32B-b79K.safetensors\"},\"class_type\":\"CLIPVisionLoader\",\"_meta\":{\"title\":\"CLIP Vision Loader (IP-Adapter)\"}},\"1001\":{\"inputs\":{\"preset\":\"PLUS (high strength)\",\"model\":[\"48\",0]},\"class_type\":\"IPAdapterUnifiedLoader\",\"_meta\":{\"title\":\"IP-Adapter Unified Loader\"}},\"1002\":{\"inputs\":{\"image\":\"character_reference.png\"},\"class_type\":\"LoadImage\",\"_meta\":{\"title\":\"Load Character Reference\"}},\"1010\":{\"inputs\":{\"weight\":0.8,\"weight_type\":\"standard\",\"combine_embeds\":\"concat\",\"start_at\":0.0,\"end_at\":1.0,\"embeds_scaling\":\"V only\",\"model\":[\"1001\",0],\"ipadapter\":[\"1001\",1],\"image\":[\"1002\",0],\"clip_vision\":[\"1000\",0]},\"class_type\":\"IPAdapterAdvanced\",\"_meta\":{\"title\":\"Apply IP-Adapter (Character)\"}}}", "mapping": {"6:text": "human_readable_prompt", "7:text": "negative_prompt", "56:image": "keyframe_image", "1002:image": "character_reference_image", "1010:weight": "ipadapter_weight"}, "metadata": {"lastSyncedAt": 1733530000000, "highlightMappings": [{"type": "human_readable_prompt", "nodeTitle": "CLIP Text Encode (Positive Prompt)", "nodeId": "6", "inputName": "text"}, {"type": "keyframe_image", "nodeTitle": "Load Keyframe Image", "nodeId": "56", "inputName": "image"}, {"type": "character_reference_image", "nodeTitle": "Load Character Reference", "nodeId": "1002", "inputName": "image"}], "missingMappings": [], "warnings": [], "notes": "Advanced WAN 2.2 5B workflow with IP-Adapter for character consistency. Uses character reference image to maintain identity across video frames. Tuned: shift=5, CFG=4.5, 20 steps. IP-Adapter weight 0.8 (adjustable via ipadapter_weight mapping). Requires character reference image for best results."}}, "video-upscaler": {"id": "video-upscaler", "label": "Video Upscaler (2x Real-ESRGAN)", "workflowJson": "{\"1\":{\"inputs\":{\"video\":\"input_video.mp4\"},\"class_type\":\"LoadVideo\",\"_meta\":{\"title\":\"Load Input Video\"}},\"2\":{\"inputs\":{\"model_name\":\"4x-UltraSharp.pth\"},\"class_type\":\"UpscaleModelLoader\",\"_meta\":{\"title\":\"Load Upscale Model\"}},\"3\":{\"inputs\":{\"upscale_model\":[\"2\",0],\"image\":[\"4\",0]},\"class_type\":\"ImageUpscaleWithModel\",\"_meta\":{\"title\":\"Upscale Frame\"}},\"4\":{\"inputs\":{\"video\":[\"1\",0]},\"class_type\":\"GetVideoComponents\",\"_meta\":{\"title\":\"Get Video Frames\"}},\"5\":{\"inputs\":{\"upscale_method\":\"lanczos\",\"scale_by\":0.5,\"image\":[\"3\",0]},\"class_type\":\"ImageScaleBy\",\"_meta\":{\"title\":\"Scale Down to Target Resolution\"}},\"6\":{\"inputs\":{\"images\":[\"5\",0],\"fps\":24,\"lossless\":false,\"quality\":90,\"method\":\"default\"},\"class_type\":\"ImagesToVideo\",\"_meta\":{\"title\":\"Convert Frames to Video\"}},\"7\":{\"inputs\":{\"filename_prefix\":\"upscaled_video\",\"format\":\"auto\",\"codec\":\"auto\",\"video\":[\"6\",0]},\"class_type\":\"SaveVideo\",\"_meta\":{\"title\":\"Save Upscaled Video\"}}}", "mapping": {"1:video": "input_video"}, "metadata": {"lastSyncedAt": 1732700000000, "highlightMappings": [{"type": "input_video", "nodeTitle": "Load Input Video", "nodeId": "1", "inputName": "video"}], "missingMappings": [], "warnings": [], "notes": "Video upscaling workflow using Real-ESRGAN or similar models. Requires a ComfyUI workflow that accepts video input and outputs upscaled video."}}}, "modelId": "wan-video", "featureFlags": {"useGenerationQueue": true}};

    if (!settings.workflowProfiles['wan-t2i'] || !settings.workflowProfiles['wan-t2i'].workflowJson || settings.workflowProfiles['wan-t2i'].workflowJson.length === 0) {
        throw new Error("wan-t2i workflowJson is missing or empty");
    }

    const dbName = 'cinematic-story-db';
    const storeName = 'misc';
    const key = 'gemDirect-settings-store';
    const value = { 
        state: { 
            ...settings, 
            _hasHydrated: true, 
            _isInitialized: true 
        }, 
        version: 0 
    };

    return new Promise((resolve, reject) => {
        const request = indexedDB.open(dbName);
        
        request.onerror = (event) => reject("Database error: " + event.target.errorCode);

        request.onsuccess = (event) => {
            const db = event.target.result;
            
            if (!db.objectStoreNames.contains(storeName)) {
                reject(`Store ${storeName} not found. Is the app loaded?`);
                return;
            }

            const transaction = db.transaction([storeName], "readwrite");
            const store = transaction.objectStore(storeName);
            const putRequest = store.put(value, key);

            putRequest.onerror = (event) => reject("Put error: " + event.target.error);
            putRequest.onsuccess = (event) => resolve("Injection successful");
        };
    });
}
