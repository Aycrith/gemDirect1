# Windows-Agent Testing - Complete Documentation Index

**Session Date**: November 11, 2025  
**Environment Status**: ✓ VALIDATED | ⏳ READY FOR E2E (pending SVD model)  
**Documentation Generated**: 4 comprehensive guides

---
## ?? Required Telemetry & Queue Policy Orientation

Reading the quick navigation docs above is the _required first step_ before editing scripts, UI hooks, or validators so you understand how the helper enforces LM Studio health checks, queue knobs, and telemetry requirements.[lm-health]
1. **Node guardrail**: `scripts/run-comfyui-e2e.ps1` and `scripts/run-vitests.ps1` both call `node -v` and require `>= v22.19.0`, so install Node 22.19.0 or newer before running the helpers. The PR workflows run on Node 22.19.0 as well, keeping CI/locally produced telemetry in sync with the validator and UI.
2. **LM Studio health check**: `scripts/run-comfyui-e2e.ps1` hits `/v1/models` before launching ComfyUI, records override/fallback notes (`LOCAL_LLM_HEALTHCHECK_URL` / `LOCAL_LLM_SKIP_HEALTHCHECK=1`), and surfaces warnings in `run-summary.txt`/`artifact-metadata.json`.
3. **Queue knobs & metadata**: `SceneMaxWaitSeconds`, `SceneHistoryPollIntervalSeconds`, `SceneHistoryMaxAttempts`, `ScenePostExecutionTimeoutSeconds`, and `SceneRetryBudget` plus the matching `SCENE_*` env vars are resolved into `QueueConfig`, each scene’s `HistoryConfig`, and `SceneRetryBudget` and re-rendered inside the Artifact Snapshot policy card and Timeline Editor.
4. **Telemetry enforcement policy**: Every `[Scene .] Telemetry:` line must list `DurationSeconds`, `MaxWaitSeconds`, `PollIntervalSeconds`, `HistoryAttempts`, `HistoryAttemptLimit`, `pollLimit` (text matching metadata), `HistoryExitReason` (maxWait/attemptLimit/postExecution/success), `ExecutionSuccessDetected`, `ExecutionSuccessAt`, `PostExecutionTimeoutSeconds`, `postExecTimeoutReached`, GPU `Name`, `VRAMBeforeMB`, `VRAMAfterMB`, `VRAMDeltaMB`, fallback notes (e.g., `/system_stats` failure triggering the `nvidia-smi` fallback), and `SceneRetryBudget`. This telemetry is validated by `scripts/validate-run-summary.ps1`, Vitest, and the UI, and the queue script honors the `/history` states (`execution_success`, `status_str`, `exitReason`) described in [`websocket_api_example.py`][comfy-history].
5. **Artifact snapshot expectations**: The Artifact Snapshot/Timeline UI must display the queue policy card, telemetry badges (DurationSeconds, MaxWaitSeconds, PollIntervalSeconds, `pollLimit`, `HistoryExitReason`, `postExec` timeout state, `ExecutionSuccessAt`), poll log counts/warnings-only filter, GPU info + VRAM delta and fallback warnings, archive links (Vitest logs + `artifacts/comfyui-e2e-<ts>.zip`), and LLM metadata (provider, model, request format, seed, duration, errors).
6. **Producer handshake & sentinel tooling**: `scripts/generate-done-markers.ps1` writes `<prefix>.done.tmp` and atomically renames it for each stable frame sequence (see https://learn.microsoft.com/dotnet/api/system.io.file.replace). `scripts/queue-real-workflow.ps1` waits for that marker, records `DoneMarker*` and forced-copy fields in telemetry, and dumps `forced-copy-debug-<ts>.txt` if it had to copy before the marker arrived; those telemetry fields plus `System.FallbackNotes` are part of the contract in `TELEMETRY_CONTRACT.md`. You can stage `comfyui_nodes/write_done_marker.py` into `custom_nodes/` via `scripts/deploy-write-done-marker.ps1` or install the sentinel as a Windows service using `scripts/install-sentinel-service.ps1` (which prints the NSSM command after downloading https://nssm.cc/download).
7. **Docs-first guardrail**: Read README.md, STORY_TO_VIDEO_PIPELINE_PLAN.md, STORY_TO_VIDEO_TEST_CHECKLIST.md, WORKFLOW_FIX_GUIDE.md, HANDOFF_SESSION_NOTES.md, QUICK_START_E2E_TODAY.md, REFERENCE_CARD_QUICK.md, WINDOWS_AGENT_TEST_ITERATION_PLAN.md, and notes/codex-agent-notes-20251111.md before editing scripts or UI so the LM Studio health check, queue knobs, telemetry enforcement, and artifact expectations are locked in.
8. **FastIteration & sentinel telemetry logging**: `scripts/run-comfyui-e2e.ps1 -FastIteration` shortens `historyPollIntervalSeconds`, `postExecutionTimeoutSeconds`, and sentinel scans, and writes a `FastIteration mode enabled: ...` line in `run-summary.txt`. Each `[Scene ...] Telemetry:` line must also surface the `DoneMarker*` fields (`DoneMarkerWaitSeconds`, `DoneMarkerDetected`, `DoneMarkerPath`) plus the `ForcedCopyTriggered`/`ForcedCopyDebugPath` entries described in `TELEMETRY_CONTRACT.md`, so forced-copy fallbacks and sentinel success/failure can be traced back from `run-summary.txt`, `artifact-metadata.json`, or the Artifact Snapshot/Timeline UI.
9. **Full testing & sweep log**: `scripts/run-comfyui-e2e.ps1` produces `logs/<ts>/run-summary.txt` (with sentinel, FastIteration, and warning lines), `artifact-metadata.json`, `vitest-comfyui.log`, `vitest-e2e.log`, `vitest-scripts.log`, `vitest-results.json`, and `artifacts/comfyui-e2e-<ts>.zip`. Rerun `scripts/run-vitests.ps1` or `scripts/validate-run-summary.ps1 -RunDir logs/<ts>` whenever you adjust telemetry shaping, and execute `scripts/generate-sweep-report.ps1` to scan `logs/` and emit `logs/stability-sweep-<timestamp>/report.json` that aggregates GPU telemetry, fallback notes, and warning flags across every run for the stability sweep log reviewers expect.
10. **UI metadata handshake**: Artifact Snapshot/Timeline cards mirror logs/<ts>/artifact-metadata.json and public/artifacts/latest-run.json, so their queue policy cards, telemetry badges, GPU stats, fallback warnings, Vitest logs, and archive references must match the validator-approved data.

[lm-health]: https://lmstudio.ai/docs/api#health-checks
[comfy-history]: https://github.com/comfyanonymous/ComfyUI/blob/master/examples/websocket_api_example.py
